---
title: php面试题整理-高并发
date: 2017-10-10 11:21:32
tags:
	- php面试
---
### 高并发 ###
		
并发访问，在某个时间点，有多少访问同时到来（日PV在千万以上）

##### 应该关心什么？ #####

**1、QPS**

- 每秒请求或者查询的数量，每秒响应请求数（HTTP），不等于并发连接数

- QPS是每秒HTTP请求数量，并发连接数是系统同时处理的请求数量

- 峰值一般是平均值的倍数，根据实际情况来定：

> 峰值每秒请求数量（QPS）= （总PV数 * 80%）/（6小时秒数 * 20%）
	
> 80%的访问量集中在20%的时间内
<!--more-->
**2、吞吐量**

单位时间内处理的请求数量（通常有QPS与并发数决定）

**3、响应时间**

从请求发出到收到响应花费时间。例如系统处理一个HTTP请求需要100ms，这个100ms就是系统的响应时间

**4、PV**

综合浏览量（page view），页面浏览量或者点击量，一个访客在24小时内访问的页面数量

**5、UV**

独立访客（unique visitor），一定时间范围内相同访客多次访问网站，只计算为1个独立访客。

**6、带宽**

需关注两个指标：峰值流量和页面的平均大小

> 日网站带宽 = PV / 统计时间（秒） * 平均页面大小（KB）* 8

### 压力测试 ###

- 测试能承受的最大并发

- 测试最大承受的QPS值

##### ab使用 #####

	ab -c -n 5000 待测试网站

##### 注意事项 #####

- 测试机器与被测试机器及其分开（测试机器本身会有损耗）

- 不要对线上服务进行压力测试

- 观察测试工具ab所在机器，以及被测试的前端机的cpu、内存、网络等都不超过最高限度的75%

##### 安装 #####
				
	yum -y install http-tool

### 优化方案 ###

QPS达到50 小型网站，一般服务器可以应付

QPS达到100 数据库缓存层、数据库负载均衡

QPS达到800 CDN加速、负载均衡

QPS达到1000 静态HTML

QPS达到2000 做业务分离、分布式存储

### 优化案例 ###

##### 流量优化 #####

防盗链处理

##### 前端优化 #####

- 减少HTTP请求（css合并）

- 添加异步请求

- 启用浏览器缓存和文件压缩

- CDN加速

- 建立独立图片服务器

##### 服务端优化 #####
			
- 页面静态化

- 并发处理（多进程、队列）

##### 数据库优化 #####

- 数据库缓存
- 分库分表、分区操作
- 读写分离
- 负载均衡

##### web服务器优化 #####

负载均衡